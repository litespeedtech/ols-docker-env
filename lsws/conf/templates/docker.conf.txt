vhroot /var/www/vhosts/$VH_NAME/
configfile $SERVER_ROOT/conf/vhosts/$VH_NAME/vhconf.conf
restrained 1
setuidmode 2
enablescript 1
allowsymbollink 1

virtualhostconfig  {
    enablegzip 1
    docroot $VH_ROOT/html/

    vhssl  {
        keyfile /root/.acme.sh/certs/$VH_NAME_ecc/$VH_NAME.key
        certfile /root/.acme.sh/certs/$VH_NAME_ecc/fullchain.cer
        certchain 1
    }

    context / {
        location $DOC_ROOT/
        allowbrowse 1

        rewrite  {
            rules rewritefile .htaccess
            unknownkeywords rewritefile .htaccess
        }
    }

    accesscontrol  {
        allow *
    }

    extprocessor lsphp80 {
        type lsapi
        address uds://tmp/lshttpd/lsphp.sock
        maxconns 35
        env PHP_LSAPI_CHILDREN=35
        env LSAPI_AVOID_FORK=200M
        inittimeout 60
        retrytimeout 0
        persistconn 1
        pckeepalivetimeout 
        respbuffer 0
        autostart 1
        path lsphp80/bin/lsphp
        backlog 100
        instances 1
        priority 0
        memsoftlimit 2047M
        memhardlimit 2047M
        procsoftlimit 1400
        prochardlimit 1500
    }

    expires  {
        enableexpires 1
    }

    extprocessor lsphp74 {
        instances 1
        priority 0
        memsoftlimit 2047M
        memhardlimit 2047M
        procsoftlimit 1400
        prochardlimit 1500
        type lsapi
        address uds://tmp/lshttpd/lsphp.sock
        persistconn 1
        pckeepalivetimeout 
        respbuffer 0
        autostart 1
        path lsphp74/bin/lsphp
        backlog 100
        maxconns 35
        env PHP_LSAPI_CHILDREN=35
        env LSAPI_AVOID_FORK=200M
        inittimeout 60
        retrytimeout 0
    }

    index  {
        autoindexuri /_autoindex/default.php
        autoindex 0
        useserver 0
        indexfiles index.html, index.php
    }

    rewrite  {
        loglevel 0
        enable 1
        autoloadhtaccess 1
    }

    accesslog $SERVER_ROOT/logs/$VH_NAME.access.log {
        useserver 0
        compressarchive 1
        rollingsize 100M
        keepdays 7
    }

    errorlog  {
        useserver 1
    }

    extprocessor lsphp81 {
        type lsapi
        address uds://tmp/lshttpd/lsphp.sock
        maxconns 35
        env PHP_LSAPI_CHILDREN=35
        env LSAPI_AVOID_FORK=200M
        inittimeout 60
        retrytimeout 0
        persistconn 1
        pckeepalivetimeout 
        respbuffer 0
        autostart 1
        path lsphp81/bin/lsphp
        backlog 100
        instances 1
        priority 0
        memsoftlimit 2047M
        memhardlimit 2047M
        procsoftlimit 1400
        prochardlimit 1500
    }

    scripthandler  {
        add lsapi:lsphp74  php
        add lsapi:lsphp80  php
        add lsapi:lsphp81  php
    }
}
